{#{% from "pz/html/nestableNav.twig" import nest as nest %}#}
{% extends 'cms/base.html.twig' %}

{#{% set model = db.byId('_Model', fragments|last) %}#}

{% set totalPages = 0 %}
{% set pageNum = app.request.get('pageNum') ?: 1 %}
{#{% set url = '/pz/' ~ (model.dataType == 0 ? 'database' : 'admin') ~ '/' ~ model.id %}#}
{% set url = '' %}

{#{% set orms = [] %}#}
{#{% if model.listType == 0 %}#}
    {#{% set orms = db.data(model.className) %}#}
{#{% elseif model.listType == 1 %}#}
    {#{% set orms = db.data(model.className, {#}
        {#page: pageNum,#}
        {#limit: model.numberPerPage,#}
        {#sort: model.defaultSortBy,#}
        {#order: model.defaultOrder == 0 ? 'ASC' : 'DESC',#}
    {#}) %}#}
    {#{% set totalPages = db.data(model.className, {#}
        {#count: 1,#}
    {#}) %}#}
    {#{% set totalPages = (totalPages.count / model.numberPerPage)|round(1, 'ceil')|number_format  %}#}
{#{% elseif model.listType == 2 %}#}
    {#{% set orms = db.data(model.className) %}#}
{#{% endif %}#}

{% block container %}
    <div id="h1">
        <h1>{{ model.title }}</h1>
        <a class="addForm button" href="{{ node.url }}/new?returnUrl={{ app.request.uri|url_encode }}">Add new record â€º</a>
    </div>

    {% if model.listType != 2 %}
        {% if orms|length > 0 %}
            <table class="table table-striped table-bordered table-hover table-middle">
                <tbody>
                    <tr>
                        <td class="tableHead" width="40px">ID</td>
                        <td class="tableHead" >Title</td>
                        <td class="tableHead" width="180px" align="right">Action</td>
                    </tr>
                </tbody>
                <tbody id="columns">
                    {% for itm in orms %}
                    <tr id="{{ itm.id }}" class="content-container">
                        <td>{{ itm.id }}</td>
                        <td>{{ itm.title }}</td>
                        <td class="iconCell" align="right">
                            <a href="#" class="approve" rel="on" data-formid="402" id="approve_2854"><img src="/cms/images/dotGreen.gif" alt="" border="0"></a>
                            <a href="{{ node.url }}/{{ itm.id }}?returnUrl={{ app.request.uri|url_encode }}"><img src="/cms/images/editIcon.gif" alt="Edit Record" title="Edit Record" border="0"></a>
                            <a href=""><img src="/cms/images/cloneIcon.gif" alt="Copy Record" title="Copy Record" border="0"></a>
                            <a href=""><img alt="Delete Record" title="Delete Record" src="/cms/images/binIcon.gif" border="0"></a>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

            {% if totalPages > 1 %}
                {% include 'pz/html/pagination.twig' %}
            {% endif %}
        {% endif %}
    {% else %}
        {#<div class="nestable-lists">#}
        {#<div class="dd" id="nestable">#}
        {#<ol class="dd-list">#}
        {#{% set root = orms|nestable(model) %}#}
        {#{% for itm in root.children %}#}
        {#{{ nest(itm, model, 1) }}#}
        {#{% endfor %}#}
        {#</ol>#}
        {#</div>#}
        {#</div>#}
    {% endif %}
{% endblock %}

{#{% block extraFooter %}#}
    {#<script>#}
        {#window._listType = '{{ model.listType }}';#}
    {#</script>#}
{#{% endblock %}#}